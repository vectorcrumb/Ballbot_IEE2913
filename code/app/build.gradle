/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */


plugins {
    id 'org.hidetake.ssh' version '2.10.1'
}

remotes {
  raspi {
    host = "10.12.34.20"
    user = 'pi'
    password = "raspberry"
  }
}

task showPlatformVersion {
    doLast {
        ssh.run {
            session(remotes.raspi) {
                execute 'uname -a'
                execute 'cat /etc/*-release', ignoreError: true
            }
        }
    }
}

task deploy {
    doFirst {
        ssh.run {
            session(remotes.raspi) {
                execute 'sudo systemctl stop ballbotui', ignoreError: true
            }
        }
    }
    doLast {
        ssh.run {
            session(remotes.raspi) {
                put from: file('web'), into: "/home/pi/ballbot"
                executeSudo 'cp /home/pi/ballbot/web/resources/ballbotui.service /etc/systemd/system/ballbotui.service'
                executeSudo 'systemctl daemon-reload; sudo service ballbotui restart; sudo service ballbotui status'
                executeSudo 'systemctl enable ballbotui'
            }
        }
    }
} 